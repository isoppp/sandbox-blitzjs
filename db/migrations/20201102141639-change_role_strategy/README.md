# Migration `20201102141639-change_role_strategy`

This migration has been generated by isoppp at 11/2/2020, 11:16:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('ADMIN', 'USER')

CREATE TABLE "public"."User" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"displayId" text   NOT NULL ,
"name" text   ,
"email" text   NOT NULL ,
"hashedPassword" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Session" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"expiresAt" timestamp(3)   ,
"handle" text   NOT NULL ,
"userId" integer   ,
"hashedSessionToken" text   ,
"antiCSRFToken" text   ,
"publicData" text   ,
"privateData" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Role" (
"id" SERIAL,
"name" "UserRole"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_RoleToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "User.displayId_unique" ON "public"."User"("displayId")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Session.handle_unique" ON "public"."Session"("handle")

CREATE UNIQUE INDEX "Role.name_unique" ON "public"."Role"("name")

CREATE UNIQUE INDEX "_RoleToUser_AB_unique" ON "public"."_RoleToUser"("A", "B")

CREATE INDEX "_RoleToUser_B_index" ON "public"."_RoleToUser"("B")

ALTER TABLE "public"."Session" ADD FOREIGN KEY("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_RoleToUser" ADD FOREIGN KEY("A")REFERENCES "public"."Role"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_RoleToUser" ADD FOREIGN KEY("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201031083523-add-project..20201102141639-change_role_strategy
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgres"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -15,13 +15,14 @@
 model User {
   id             Int       @default(autoincrement()) @id
   createdAt      DateTime  @default(now())
   updatedAt      DateTime  @updatedAt
+  displayId      String    @default(cuid()) @unique
   name           String?
   email          String    @unique
   hashedPassword String?
-  role           String    @default("user")
   sessions       Session[]
+  roles          Role[]
 }
 model Session {
   id                 Int       @default(autoincrement()) @id
@@ -36,10 +37,21 @@
   publicData         String?
   privateData        String?
 }
+enum UserRole {
+  ADMIN
+  USER
+}
+
+model Role {
+  id    Int      @default(autoincrement()) @id
+  name  UserRole @unique
+  users User[]
+}
+
 model Project {
   id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
-  name      String   
+  name      String
 }
```


